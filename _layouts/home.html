---
layout: default
refactor: true
---
{%- comment -%}
  home.html – 113bommy.github.io
  Patch: ensure "Home" label remains visible when sidebar Home link is active
{%- endcomment -%}
<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
  {%- include head.html -%}
  <body>
    {%- include sidebar.html -%}
    <div class="page-wrapper d-flex flex-column">
      {%- include topbar.html -%}

      <main class="flex-fill">
        <!-- ▣ 1. INTRO -------------------------------------------------- -->
        <section id="home-intro" class="text-center py-5 container-xl px-4">
          <img src="{{ site.avatar | default: '/assets/img/avatar.png' | relative_url }}" class="rounded-circle mb-3 shadow" style="width:120px;height:120px;object-fit:cover;" alt="avatar">
          <h1 class="h3 fw-bold mb-1">{{ site.title }}</h1>
          <p class="lead mb-0">{{ site.tagline | default: site.description }}</p>
        </section>

        <!-- ▣ 2. RECENT POSTS ------------------------------------------- -->
        <section id="recent-posts" class="py-5 bg-body-tertiary">
          <div class="container-xl px-4">
            <h2 class="h4 fw-semibold mb-4">최근 포스트</h2>
            <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
              {%- assign recent_posts = site.posts 
                    | where_exp: "p","p.hidden != true" 
                    | where_exp: "p","p.draft != true" 
                    | sort: 'date' | reverse | slice: 0,4 -%}
              {%- for post in recent_posts -%}
                {%- assign thumb = nil -%}

                {%- if post.img_path %}
                  {%- assign thumb = post.img_path -%}
                {%- else -%}
                  {%- capture html_content %}{{ post.content | markdownify }}{%- endcapture -%}
                  {%- assign tmp = html_content | split: ' src="' -%}
                  {%- if tmp.size > 1 -%}
                    {%- assign first_src_part = tmp[1] | split: '"' | first -%}
                    {%- assign thumb = first_src_part -%}
                  {%- endif -%}
                {%- endif -%}

                {%- if thumb == nil or thumb == '' -%}
                  {%- assign thumb = '/assets/img/default-thumbnail.webp' -%}
                {%- endif -%}

                {%- unless thumb contains '://' -%}
                  {%- assign thumb = thumb | relative_url -%}
                {%- endunless -%}

                <div class="col">
                  <a href="{{ post.url | relative_url }}" class="card h-100 border-0 shadow-sm text-decoration-none">
                    <div class="ratio ratio-4x3 bg-light d-flex align-items-center justify-content-center">
                      <img src="{{ thumb }}" class="thumb-fixed" alt="{{ post.title }} thumbnail">
                    </div>
                    <div class="card-body">
                      <h3 class="card-title h6 mb-1 fw-bold text-dark">{{ post.title }}</h3>
                      <p class="card-text small text-muted mb-0">{{ post.date | date: '%Y-%m-%d' }}</p>
                    </div>
                  </a>
                </div>
              {%- endfor -%}
            </div>
          </div>
        </section>

        <!-- ▣ 3. CATEGORY TREEMAP --------------------------------------- -->
        <section id="category-section" class="py-5 container-xl px-4">
          <h2 class="h4 fw-semibold mb-4">카테고리</h2>
          <div id="treemap" style="height:520px;position:relative;"></div>
        </section>
      </main>

      {%- include footer.html -%}
    </div>

    <!-- ▣ Custom CSS --------------------------------------------------- -->
    <style>
      /* 썸네일: 비율 유지하면서 여백 처리 */
      .thumb-fixed {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        object-position: center center;
      }
      .ratio-4x3 { --bs-aspect-ratio: 75%; }

      /* Fix: ensure label text visible when Home link is active */
      .sidebar .nav-link.active span { opacity: 1 !important; visibility: visible !important; color: inherit !important; }
    </style>

    <!-- ▣ D3 Treemap script ------------------------------------------- -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const data = { name:'categories', children:[
          {% assign cats = site.categories %}{% for cat in cats %}{ name:'{{ cat[0] | slugify }}', label:'{{ cat[0] }}', value:{{ cat[1].size }} }{% unless forloop.last %},{% endunless %}{% endfor %}
        ]};
        const container=document.getElementById('treemap'); if(!container||!data.children.length)return;
        const width=container.getBoundingClientRect().width, height=container.getBoundingClientRect().height;
        const root=d3.treemap().size([width,height]).paddingInner(4)(d3.hierarchy(data).sum(d=>d.value));
        const color=d3.scaleOrdinal(d3.schemeSet3);
        const div=d3.select(container);
        const nodes=div.selectAll('div.tnode').data(root.leaves()).enter().append('div').attr('class','tnode')
          .style('position','absolute').style('left',d=>d.x0+'px').style('top',d=>d.y0+'px')
          .style('width',d=>Math.max(0,d.x1-d.x0)+'px').style('height',d=>Math.max(0,d.y1-d.y0)+'px')
          .style('background',(d,i)=>color(i)).style('border-radius','6px').style('overflow','hidden')
          .style('cursor','pointer').style('opacity',.9).on('click',(e,d)=>{window.location.href='{{ site.baseurl | default: "" }}/categories/'+d.data.name+'/';});
        nodes.append('span').style('display','block').style('padding','6px').style('font-size','0.8rem').style('color','#000')
          .style('font-weight','600').style('line-height','1.2').text(d=>d.data.label+' ('+d.data.value+')');
      });
    </script>

    {%- include search-loader.html -%}
  </body>
</html>
